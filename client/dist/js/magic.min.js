/*
 test 2017-02-28 
*/
!function(){"use strict";var a=angular.module("VideoApp",["ui.router","angular-md5","angular-loading-bar","ngSanitize","com.2fdevs.videogular","infinite-scroll"]);a.config(["$locationProvider","$stateProvider","$urlRouterProvider","cfpLoadingBarProvider",function(a,b,c,d){d.includeSpinner=!1,a.html5Mode({enabled:!0,requireBase:!1});var e,f=["$q","LoginService",function(a,b){return e=b.getUserInfo(),e?a.when(e):a.reject({authenticated:!1})}];b.state("/",{url:"/login",templateUrl:"/components/login/LoginView.html"}).state("/dashboard",{url:"/dashboard?sessionId",templateUrl:"/components/dashboard/DashboardView.html",controller:"DashboardController as dashboardCtrl",resolve:{loginRequired:f}}).state("/videoview",{url:"/videoview?videoId?sessionId",controller:"VideoController",views:{video:{templateUrl:"/components/video/VideoView.html",resolve:{loginRequired:f}}}}),c.otherwise("/login")}]),a.run(["$rootScope","$location","$window",function(a,b){a.$on("$routeChangeSuccess",function(a){}),a.$on("$routeChangeError",function(a,c,d,e){e.authenticated===!1&&b.path("/login")})}])}(),function(){angular.module("VideoApp").controller("DashboardController",["$window","$rootScope","$scope","$state","$stateParams","$location","DashboardService","VideoService","$sce",function(a,b,c,d,e,f,g,h,i){this.config={preload:"none",sources:[{src:i.trustAsResourceUrl("http://static.videogular.com/assets/videos/videogular.mp4"),type:"video/mp4"},{src:i.trustAsResourceUrl("http://static.videogular.com/assets/videos/videogular.webm"),type:"video/webm"},{src:i.trustAsResourceUrl("http://static.videogular.com/assets/videos/videogular.ogg"),type:"video/ogg"}],tracks:[{src:"http://www.videogular.com/assets/subs/pale-blue-dot.vtt",kind:"subtitles",srclang:"en",label:"English",default:""}],theme:{url:"http://www.videogular.com/styles/themes/default/latest/videogular.css"}},this.players=[],this.onPlayerReady=function(a,b){this.players[b]=a},this.onUpdateState=function(a,b){if("play"===a)for(var c=0,d=this.players.length;c<d;c++)c!==b&&this.players[c].pause()},c.username=JSON.parse(a.sessionStorage.userInfo).username,c.loadMore=function(){h.getVideos(e.sessionId).success(function(a){c.videos=a,console.log(a)}).error(function(a){c.error=a})},c.loadMore(),c.rateFunction=function(a,b){console.log("rating",a,"video",b),h.rateViedo(e.sessionId,b._id,a).success(function(a){console.log(a)}).error(function(){console.log(status)})},this.getSingleVideo=function(a){var b=a.currentTarget.attributes[0].nodeValue;console.log("vid = > ",b),d.go("/videoview",{videoId:b,sessionId:e.sessionId})},c.getRatings=function(a,b){g.getVideoRatings().success(function(a){c.ratings=a}).error(function(){console.log(status)})}}])}(),angular.module("VideoApp").factory("DashboardService",["$rootScope","$http","$window","$stateParams",function(a,b,c,d){return console.log(d.sessionId),{getVideos:function(){return b({url:"/videos",method:"GET",params:{sessionId:d.sessionId}})},getVideo:function(a){return b({url:"/video",method:"GET",params:{sessionId:d.sessionId,videoId:a}})},getVideoRatings:function(){return b({url:"/video/ratings",method:"POST",params:{sessionId:d.sessionId}})}}}]),function(){"use strict";angular.module("VideoApp").filter("webm",["$log",function(a){return function(a){return a?a.split(".mp4")[0]+".webm":a}}])}(),angular.module("VideoApp").factory("AuthService",function(){var a={isLogged:!1};return a}),function(){angular.module("VideoApp").controller("LoginController",["$rootScope","$scope","$location","$state","$window","LoginService","AuthService","md5",function(a,b,c,d,e,f,g,h){b.login=function(a,c){void 0!==a&&void 0!==c?(c=h.createHash(c||""),f.logIn(a,c).then(function(a){a.sessionId?d.go("/dashboard",{sessionId:a.sessionId}):alert("Username/Password combination is incorrect")},function(a){b.loginError=a})):alert("Please Enter the Username/password")},b.logout=function(){f.logOut(),d.go("/")}}])}(),angular.module("VideoApp").factory("LoginService",["$http","$window","$q","$location",function(a,b,c,d){function e(){b.sessionStorage.userInfo&&(f=JSON.parse(b.sessionStorage.userInfo))}var f;return e(),{getUserInfo:function(){return f},logIn:function(d,e){var d,g=c.defer();return a.post("/user/auth",{username:d,password:e}).then(function(a){f={sessionId:a.data.sessionId,username:a.data.username},b.sessionStorage.userInfo=JSON.stringify(f),g.resolve(f)},function(a){console.log("loginService error",a),g.reject(a)}),g.promise},logOut:function(){var d=c.defer();return a({url:"/user/logout",method:"GET",params:{sessionId:f.sessionId}}).then(function(a){b.sessionStorage.userInfo=null,f=null,d.resolve(a)},function(a){d.reject(a)}),d.promise}}}]),angular.module("VideoApp").directive("starRating",function(){return{restrict:"A",template:'<ul class="rating">\t<li ng-repeat="star in stars" ng-class="star" ng-click="toggle($index)">â˜…</li></ul>',scope:{ratingValue:"=",max:"=",onRatingSelected:"&"},link:function(a,b,c){var d=function(){a.stars=[];for(var b=0;b<a.max;b++)a.stars.push({filled:b<a.ratingValue})};a.toggle=function(b){a.ratingValue=b+1,a.onRatingSelected({rating:b+1})},a.$watch("ratingValue",function(a,b){b&&d()})}}}),angular.module("VideoApp").controller("VideoController",["$window","$rootScope","$scope","VideoService","$stateParams","$state",function(a,b,c,d,e,f){b.videoId,JSON.parse(a.sessionStorage.userInfo).sessionId,JSON.parse(a.sessionStorage.userInfo).username;c.rating=5,console.log("in video controller"),c.getSingle=function(){console.log("calling getSingle"),d.getSingleVideo(e.sessionId,e.videoId).success(function(a){console.log(a),c.single_video=a.data,console.log(c.single_video),f.go("/videoview",{videoId:e.videoId,sessionId:e.sessionId})}).error(function(a){c.error=a,console.log(status)})},c.getSingle()}]),angular.module("VideoApp").service("VideoService",["$window","$http","$stateParams",function(a,b,c){return{getSingleVideo:function(a,c){return b({url:"/video",method:"GET",params:{sessionId:a,videoId:c}})},getVideos:function(a){return b({url:"/videos",method:"GET",params:{sessionId:a}})},rateViedo:function(a,c,d){return b.post("/video/ratings?sessionId="+a,{videoId:c,rating:d})}}}]);